<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>{{ site.title }}</title>
		<link rel="shortcut icon" href="/static/img/favico.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="IE=Edge">

		<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:200,400,600,400italic,600italic" rel="stylesheet" type="text/css" />

		<!-- Default site theme ID is 1 -->
		<link href="{{ STATIC_URL }}themes/{% if site.theme_id %}{{ site.theme_id }}{% else %}1{% endif %}/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
		<link href="{{ STATIC_URL }}themes/{% if site.theme_id %}{{ site.theme_id }}{% else %}1{% endif %}/css/base.css" rel="stylesheet" type="text/css" />
		<link href="{{ STATIC_URL }}themes/{% if site.theme_id %}{{ site.theme_id }}{% else %}1{% endif %}/css/prettify.css" rel="stylesheet" type="text/css" />

		<style type="text/css">
		.headBand {
			background-image: url('{% if site.header_background_url %}{{ site.header_background_url }}{% else %}{{ STATIC_URL }}themes/1/background.png{% endif %}');
		}
		</style>

		<!-- For custom page css (e.g. event.html) -->
		{% block css %}{% endblock %}

		<!--[if lt IE 9]>	
		  <script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.1.0/respond.min.js"></script>
		  <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
	</head>

<body>

	<!-- Site banner and user module -->
	<div class="headBand">
		<div class="container">
			<header class="row">
				<div class="col col-sm-16">
					<div class="row">
						<div id="logo" class="col col-sm-4 margin-top-half">	
							<a href="/"><img src="{% if site.logo_url %}{{ site.logo_url }}{% else %}{{ STATIC_URL }}themes/1/logo.png{% endif %}" alt="{{ site.title }} - Powered by Microcosm" id="logo" /></a>
						</div>
						<div class="col col-sm-5 col-sm-push-1 col-md-push-0 col-lg-8">
		                    <form class="navbar-form navbar-left" action="/search/" method="GET" onsubmit="return validateNotEmpty()">
		                      <br />
		                      <div class="input-group">
		                        <div class="input-group-addon" id="searchbutton" onclick="focusOnClick()">
		                          <span class="glyphicon glyphicon-search"></span>
		                        </div>
		                        <input type="text" id="searchbar" class="form-control" name="q" {% if content.query.searched %}value="{{content.query.searched|safe}}"{% endif %} placeholder="Search..."/>
		                      </div>
		                    </form>
		                  </div>
						<div id="whoami">
						{% block whoami %}
							{% if user %}
								<div class="col col-sm-4 col-sm-push-2 col-md-4 col-md-push-1 col-lg-3 whoami">
									<div class="row margin-top-half">
										<a href="{% url 'edit-profile' user.id %}" id="edit_profile">
                                            <img src="{% if 'gravatar' in user.avatar %}{{user.avatar}}{% elif 'files' in user.avatar %}https://{{site.subdomain_key}}.microco.sm{{user.avatar}}{% else %}/static/img/avatar.gif{% endif %}" alt="Avatar for {{ user.profile_name }}" title="Edit your profile" class="gravatar" align="left" />
                                        </a>
										<a href="{% url 'list-updates' %}" id="updates">Updates{% if user.unread_count %} (<span class="unread">{{ user.unread_count }}</span>){% endif %}</a><br />
                                        <a href="{% url 'edit-profile' user.id %}" id="profile_name">Edit profile</a><br />
										<a href="{% url 'logout' %}" id="logout">Log out</a>
									</div>
								</div>
							{% else %}
								<div class="col col-sm-4 col-sm-push-2 col-md-4 col-md-push-1 col-lg-3 whoami">
									Browsing as a guest.
									<a class="btn btn-primary btn-block" id="login_link" href="javascript:login()">Sign In or Register</a><br />
								</div>
							{% endif %}
						{% endblock %}
                        </div>
					</div>
				</div>
			</header>
		</div>
	</div>

	<!-- Container for main page content -->
	<div class="container">
		{% block notifications %}{% endblock %}
		{% block breadcrumb %}{% endblock %}

		<div class="row">
			<section id="content" class="col col-sm-10 col-md-12">
				{% block content %}{% endblock %}
			</section>

			<section id="sidebar" class="col col-sm-offset-1 col-sm-5 col-md-offset-1 col-md-3">
				{% block sidebar %}{% endblock %}
			</section>
		</div>

		<footer class="row">
			<div class="col col-sm-offset-11 col-sm-5 col-md-offset-13 col-md-3 col-lg-offset-13 col-lg-3">
				<small>Powered by <a href="http://microco.sm/" title="{{ site.title }} is powered by Microcosm">Microcosm</a></small>
			</div>
		</footer>
	</div>

	{% if not user %}
		<!-- Persona Login Form (submitted by persona login action, not directly by user) -->
		<form id="login-form" method="POST" action="{% url 'login' %}">
			{% csrf_token %}
			<input id="Assertion" type="hidden" name="Assertion" value="" />
			<input id="target_url" type="hidden" name="target_url" value="{{ request.get_full_path }}" />
		</form>

		<!-- Mozilla Persona -->
		<script src="{{ STATIC_URL }}js/persona.js"></script>
		<script>
			function login() {
				navigator.id.get(function(assertion) {
					if (assertion) {
						var assertion_field = document.getElementById("Assertion");
						assertion_field.value = assertion;
						var login_form = document.getElementById("login-form");
						login_form.submit();
					}
				});
			}
		</script>
	{% endif %}

	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.2/jquery-ui.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.0.0/moment.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script>
	<script src="{{ STATIC_URL }}js/bootstrap.min.js"></script>
	<script src="{{ STATIC_URL }}js/base.js"></script>

	<script>
		function validateNotEmpty() { 
		    var mystring = document.getElementById('searchbar').value; 
		    if(!mystring.match(/\S/)) return false;
		    return true;
	    };

	    function focusOnClick() {
	    	document.getElementById('searchbar').focus();
	    }
	</script>

	<!-- For custom page js (e.g. event.html) -->
	{% block js %}{% endblock %}

	<!-- Google Analytics -->
	<script type="text/javascript">
		{% if site.subdomain_key == 'dev1' or site.subdomain_key == 'dev2' %}window['ga-disable-UA-36931318-3'] = true;{% endif %}

		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		var gaData = {
			'dimension1': '{% if user %}contributor{% else %}lurker{% endif %}'
			,'dimension4': '{{ site.subdomain_key }}'
			{% block ga %}{% endblock %}
		};

		ga('create', 'UA-36931318-3', 'microco.sm');
		ga('send', 'pageview', gaData);

		{% if site.ga_web_property_id %}ga('create', '{{ site.ga_web_property_id }}', {'name': '{{ site.subdomain_key }}'});
		ga('{{ site.subdomain_key }}.send', 'pageview', gaData);{% endif %}
	</script>

</body>
</html>