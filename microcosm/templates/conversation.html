{% extends 'base.html' %}

{% block ga %},'dimension2': '{{ content.meta.created_by.id }}'
      ,'dimension3': '{{ content.microcosm_id }}'{% endblock%}

{% block content %}
<div class="content-header padded">
  <div class="row">
    <div class="col-sm-8">
      {% include 'breadcrumbs.html' %}
    </div>
    <div class="col-sm-4">
      {% include 'pagination.html' %}
    </div>
  </div>
</div>

  <div class="content-body">
    <div class="item">
      <div class="item-header">
        <h1>{{ content.title }}</h1>
        <div class="item-meta">
          Posted on <strong>{{ content.meta.created|date:"D jS, F Y"}}</strong>
        </div>
      </div>
      {% include 'block_comments.html' %}
    </div> <!-- item -->

  </div> <!-- / content-body -->

<a name="reply"></a>
  <div class="reply-container">
    <ul class="list-comments">
      <li class="comment-item">
        <div class="comment-item-inner">
          <div class="comment-item-header">
            <div class="comment-item-author">
                <img src="{% if 'gravatar' in user.avatar %}{{user.avatar}}{% elif 'files' in user.avatar %}https://{{site.subdomain_key}}.microco.sm{{user.avatar}}{% else %}/static/img/avatar.gif{% endif %}" alt="Avatar for {{ user.profile_name }}"/>
                <strong>Post a reply</strong>
            </div>
          </div>
          <div class="comment-item-body">
            {% include 'forms/block_comment_box.html' %}
          </div>
        </div>
      </li>
    </ul>
  </div> <!-- /reply-container -->

<div class="content-footer padded">
  <div class="row">
    <div class="col-sm-12">
      {% include 'breadcrumbs.html' %}
    </div>
  </div>
</div>
{% endblock content %}

{% block sidebar %}

  <div class="metabar-module">
    <h5>Got something to add?</h5>
    <div class="metabar-module-primary-buttons">
      <a id="post-a-reply-handle" href="#reply" class="btn btn-large btn-block btn-primary">
        <span class="sprite sprite-speech-bubble-small"></span> Post a reply
      </a>
    </div>
  </div> <!-- primary actions -->

  <div class="metabar-module">
    <h5>About</h5>
    <div class="metabar-module-title">
      <h3>
        {{ content.title }}
      </h3>


      <p>
        {{ content.description }}
      </p>

      {% include 'forms/subscribe.html' %}

      <p class="metabar-module-author">
        <a href="{% url 'single-profile' content.meta.created_by.id %}">
          <img src="{% if 'gravatar' in content.meta.created_by.avatar %}{{ content.meta.created_by.avatar }}{% elif 'files' in  content.meta.created_by.avatar  %}https://{{site.subdomain_key}}.microco.sm{{ content.meta.created_by.avatar }}{% else %}/static/img/avatar.gif{% endif %}" alt="Avatar for {{ content.meta.created_by.profile_name }}" />
          @{{ content.meta.created_by.profile_name|truncatechars:25 }}
        </a> started <time datetime="{{ content.meta.created|date:"c" }}"></time>
      </p>
    </div>
  </div> <!-- / about -->


{% endblock %}

{% block js %}
{% if user %}
<script type="text/javascript" src="{{ STATIC_URL }}js/comments.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/formValidator.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/attachments.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/simpleEditor.js"></script>
<script type="text/javascript">
(function(){

  var comments = new Comments({
    el               : '.content-body',
    defaultContainer : '.reply-container',
    template         : $('.reply-container .comment-item-body').html().trim()
  });

  var replyBox = new simpleEditor({
    el : '.reply-box'
  });

  $('#post-a-reply-handle').on('click',function(e){
    var selectedText = Comments.prototype.getWindowSelectedText();
    if (selectedText){
      replyBox.textarea.value = selectedText;
      replyBox.quote();
    }
  });

})();
</script>
{% endif %}
{% endblock js %}