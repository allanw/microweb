{% extends 'base.html' %}

{% block ga %},'dimension2': '{{ content.meta.created_by.id }}','dimension3': '{{ content.microcosm_id }}'{% endblock%}

{% block css %}
    <!-- Leaflet -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/leaflet/0.6.4/leaflet.css" rel="stylesheet" type="text/css" />
    <!--[if lte IE 8]>
      <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/leaflet/0.6.4/leaflet.ie.min.css" />
    <![endif]-->
{% endblock %}


{% block content %}
<div class="content-header padded">
  <div class="row">
    <div class="col-sm-12">
    {% include 'breadcrumbs.html' %}
    </div>
  </div>
</div>

<div class="content-body">
  <div class="item">

    <div class="item-header">
      <h1>{{content.title}}</h1>
      <div class="item-meta">Posted on {{ content.meta.created|date:"D jS, F Y"}}</div>
    </div>

    {% if content.comments.page > 1 %}
      {% include 'event_header_small.html' %}
    {% else %}
      {% include 'event_header_large.html' %}
    {% endif %}

    {% include 'block_comments.html' %}

  </div> <!-- item -->
</div> <!-- / content-body -->

<div class="reply-container">
  <ul class="list-comments">
    <li class="comment-item">
      <div class="comment-item-inner">
        <div class="comment-item-header">
          <div class="comment-item-author">
              <img src="{{ STATIC_URL }}{{ user.avatar}}" />
              <strong>Post a reply</strong>
          </div>
        </div>
        <div class="comment-item-body">
          {% include 'forms/block_comment_box.html' %}
        </div>
      </div>
    </li>
  </ul>
</div> <!-- /reply-container -->


<div class="content-footer padded">
  <div class="row">
    <div class="col-sm-12">
    {% include 'breadcrumbs.html' %}
    </div>
  </div>
</div> <!-- /content-footer -->

{% endblock content %}

{% block sidebar %}

  <div class="metabar-module">
    <h5>Got something to add?</h5>
    <div class="metabar-module-primary-buttons">
      <a href="#" class="btn btn-large btn-block btn-primary">
        <span class="glyphicon glyphicon-comment"></span> Post a reply
      </a>
    </div>
  </div> <!-- primary actions -->

  <div class="metabar-module">
    <h5>About</h5>
    <div class="metabar-module-title">
      <h3>
        {{ content.title }}
      </h3>

      {% include 'forms/subscribe.html' %}

      <p>
        {{ content.description }}
      </p>
      <p class="metabar-module-author">
        <a href="{% url 'single-profile' content.meta.created_by.id %}">
          <img src="{% if 'gravatar' in content.meta.created_by.avatar %}{{ content.meta.created_by.avatar }}{% elif 'files' in  content.meta.created_by.avatar  %}https://{{site.subdomain_key}}.microco.sm{{ content.meta.created_by.avatar }}{% else %}/static/img/avatar.gif{% endif %}" alt="Avatar for {{ content.meta.created_by.profile_name }}" />
          @{{ content.meta.created_by.profile_name|truncatechars:25 }}
        </a> started <time datetime="{{ content.meta.created|date:"c" }}"></time>
      </p>
    </div>
  </div> <!-- / about -->


{% endblock %}

{% block js %}

{% if content.comments.page == 1 %}
<script src="//cdnjs.cloudflare.com/ajax/libs/leaflet/0.6.4/leaflet.js"></script>
<script src="https://maps.google.com/maps/api/js?v=3.2&key=AIzaSyAQiDoalPm41b4e-tuIecK39xoaPPV5k3E&sensor=false"></script>

<script src="{{ STATIC_URL }}js/leaflet.js"></script>
<script src="{{ STATIC_URL }}js/event.js"></script>

<script type="text/javascript">
var eventMap = new EventMap({
  map : 'map-canvas'
});

eventMap.restore(
  {{ content.lat|default:"null" }},
  {{ content.lon|default:"null" }},
  [
    [ {{ content.north|default:"null" }}, {{ content.west|default:"null" }} ],
    [ {{ content.south|default:"null" }}, {{ content.east|default:"null" }} ]
  ]
);
{% endif %}
</script>

<script type="text/javascript" src="{{STATIC_URL}}js/comments.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/formValidator.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/simpleEditor.js"></script>
<script type="text/javascript">
  (function(){

    var se = new simpleEditor({
      el : '.reply-box'
    });

  })();
</script>

{% if content.comments.page > 1 %}
{% comment %}
Toggle for event single page item event div for small screens
{% endcomment %}
<script type="text/javascript">
  (function(){
    // expanding item-event-div
    $('.item-event-expand-handle').on('click',function(){
      if ($('.item-event-compact').hasClass('item-event-expanded')){
        $('.item-event-compact').removeClass('item-event-expanded');
      }else{
        $('.item-event-compact').addClass('item-event-expanded');
      }
    });
  })();
</script>
{% endif %}

{% endblock js %}
