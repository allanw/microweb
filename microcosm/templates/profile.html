{% extends 'base.html' %}

{% load conversation %}
{% load event %}

{% block title %}@{{ content.profile_name }} | {{ site.title }}{% endblock title %}

{% block content %}
					<div class="content-header padded">
						<div class="row">
							<div class="col-xs-12">
								{% include 'breadcrumbs.html' %}
							</div>
						</div>
					</div>

					<div class="content-body padded">

						<div class="profile-header">

							<img class="profile-header-avatar"
									 src="{% if 'gravatar' in content.avatar %}{{content.avatar}}{% elif 'files' in content.avatar %}https://{{site.subdomain_key}}.microco.sm{{content.avatar}}{% else %}/static/img/avatar.gif{% endif %}" class="gravatar" alt="Avatar for {{ content.profile_name }}" />
							<div class="profile-header-text">
								<h1>{{content.profile_name}}</h1>
								Member since {{ content.created|date:"M Y" }}
								&bull;
								Last active {{content.last_active|date:"M Y"}}
							</div>
							 <ul class="list-stats profile-header-stats">
									<li>
										<span>{{content.item_count}}</span>
										conversations
									</li>
									<li>
										<span>{{content.comment_count}}</span>
										comments
									</li>
								</ul>
						</div> <!-- /profile-header -->

						{% if description %}
						<div class="comment-item-body profile-description">
							{{ description.text | safe}}
						</div> <!-- /profile-description -->
						{% endif %}

{% comment %}

						<div class="profile-section">
							<h2>Events attending</h2>
							{% with events_attending as items %}
								{% include 'microweb_templates/list_items.html' %}
							{% endwith %}
						</div>

						<div class="profile-section">
							<h2>Events attended</h2>
							{% with events_attended as items %}
								{% include 'microweb_templates/list_items.html' %}
							{% endwith %}
						</div>
{% endcomment %}
						<!-- START :: SEARCH -->
						<div class="profile-section">

						{% if search.results.items|length == 0 %}
							<div class="list-search-empty bordered padded">
								<h2>Recent activity</h2>
								<p>
									This person has not yet posted anything.
								</p>
							</div>
						{% else %}
							<ul class="list-collection bordered padded">
								<h2>Recent activity</h2>

								{% for result in search.results.items %}

									{% if result.item_type == 'conversation' %}
										{% conversation result %}
									{% elif result.item_type == 'event' %}
										{% event result %}
									{% elif result.item_type == "microcosm" %}
									{# MICROCOSMS #}
								<li id="{{ result.itemType }}{{ result.item.id }}" class="list-collection-row">
									<div class="row">
										<div class="col-sm-12">
											<div class="list-collection-row-icon">
												<a class="sprite sprite-microcosm" title="Microcosm"></a>
											</div>
											<div class="list-collection-row-offset">
												<div class="row-title">
													<a href="{{ result.item.meta.links.self.href }}">
														<h3 class="row-title">{{ result.item.title }}</h3>
													</a>
												</div>
												<div class="row-meta">
													{{ result.item.description }}
												</div>
											</div>
										</div>
									</div>
								</li>
									{% elif result.item_type == "profile" %}
								<li id="{{ result.itemType }}{{ result.item.id }}" class="list-collection-row">
									<div class="row">
										<div class="col-sm-12">
											<div class="list-collection-row-icon">
												<a class="sprite sprite-user" title="User"></a>
											</div>
											<div class="list-collection-row-offset">
												<div class="row-title row-title-profile">
													<a href="{% url 'single-profile' result.item.id %}">
														<strong>@{{ result.item.profile_name }}</strong>
													</a>
												</div>
											</div>
										</div>
									</div>
								</li>
									{% else %}

								<li id="{{ result.itemType }}{{ result.item.id }}" class="list-collection-row">
									<div class="row">
										<div class="col-sm-12">
											<div class="list-collection-row-icon">
												{% if result.item_type == 'event' %}
												<a class="sprite sprite-calendar" title="Event"></a>
												{% else %}
												<a class="sprite sprite-speech-bubble-single" title="Comment"></a>
												{% endif %}
											</div>
											<div class="list-collection-row-offset">

												<div class="row-title">

													{% if result.item_type == 'conversation' or result.item_type == 'event'%}
													<a href="/{{ result.item_type }}s/{{ result.item.id }}/{% if user %}newest/{% endif %}">
														<h3 class="row-title">{{ result.highlight|safe }}</h3>
													</a>
													{% else %}
													<a href="{{ result.item.meta.links.self.href }}/incontext/">
														<h3 class="row-title">{{ result.parent_item.title }}</h3>
													</a>
													{% endif %}

												</div>
												<div class="row-meta">
													in
													{% if result.item_type == 'comment'%}
													<a href="{{ result.parent_item.meta.links.microcosm.href }}">{{ result.parent_item.meta.links.microcosm.title }}</a>
													{% else %}
													<a href="{{ result.item.meta.links.microcosm.href }}">{{ result.item.meta.links.microcosm.title }}</a>
													{% endif %}
													&bull; <time datetime="{{ result.item.meta.created|date:"c" }}">{{ result.item.meta.created|timesince }}</time>

													{% if result.item_type == 'comment'%}
													<div class="row-meta-excerpt">
														<div class="row-meta-excerpt-text">
															{{ result.highlight|safe }}
														</div>
													</div>
													{% endif %}

												</div>
											</div>
										</div>
									</div>
								</li>
								{% endif %}
							{% endfor %}

							</ul>
						{% endif %}
						</div>
						<!-- END :: SEARCH -->
					</div>

{% endblock content %}
{% block sidebar %}

	<div class="metabar-module">
		<h5>Got something to add?</h5>
		<div class="metabar-module-primary-buttons">
			<a href="#" class="btn btn-large btn-block btn-primary">
				<span class="glyphicon glyphicon-envelope"></span> Send message
			</a>
		</div>
	</div> <!-- primary actions -->

	<div class="metabar-module">
		<h5>Profile</h5>
		<div class="metabar-module-body">
			{% include 'forms/subscribe.html' %}
		</div>
	</div> <!-- / about -->

{% endblock %}
{% block js %}
<script type="text/javascript">
	var subscribe = new Subscribe({
		el    : '.subscribe',
		url   : '{% url 'single-watcher' %}',
		id    : {{ content.id }},
		type  : '{{ item_type }}',
		token : '{{ csrf_token }}',
		is_subscribed : {{ content.meta.flags.watched|lower|default:"false" }}
	});
</script>
{% endblock %}