{% extends 'microweb_templates/base.html' %}

{% block title %}{% if form.id > 0 %}Edit conversation{% else %}Start a conversation{% endif %}{% endblock title %}

{% block content %}

	<div class="content-header padded">
		<div class="row">
			<div class="col-sm-12">
			</div>
		</div>
		<h1>{% if form.id > 0 %}Edit conversation{% else %}Start a conversation{% endif %}</h1>
	</div>

	<div class="content-body">

		<div class="row form-container">
			<div class="col-lg-12">
				<div class="form-container-inner padded">
					<form role="form" action="" method="POST" id="conversationForm">

						{% csrf_token %}
						{{ form.microcosmId }}
						{{ form.id }}
						{{ form.sticky }}
						{{ form.moderated }}
						{{ form.visible }}
						{{ form.deleted }}


						{# title #}
						<div class="form-group">
							<div class="row">

								<label class="col-sm-12" for="title">
									{{ form.title.label }}
								</label>
								<div class="col-sm-12">
									{% if form.errors.title %}
										<div class="text-error">{{ form.errors.title.as_text }}</div>
									{% endif %}
									<input
										type="text"
										class="form-control {% if form.errors.title %}error{% endif %}"
										id="title"
										name="{{ form.title.name }}" placeholder="Title of conversation"
										maxlength="150"
									/>
								</div>

							</div>
						</div> <!-- /form-group -->

						{# reason #}
						{% if form.id > 0 %}
						<div class="form-group">
							<div class="row">
								<label class="col-sm-12" for="editReason">
									{{ form.editReason.label }}
								</label>
								<div class="col-sm-12">
									{% if form.errors.editReason %}
										<div class="text-error">{{ form.errors.editReason.as_text }}</div>
									{% endif %}
									<input
										type="text"
										class="form-control {% if form.errors.editReason %}error{% endif %}"
										id="editReason"
										name="{{ form.editReason.name }}"
										placeholder="Reason for editing"
										maxlength="150"
									/>
								</div>
							</div>
						</div> <!-- /form-group -->
						{% endif %}

						<div class="form-group">
							<div class="row">

								<label class="col-sm-12" for="reply-box-textarea">
									What is it you want to say?
								</label>
								<div class="col-sm-12">
									{% include 'microweb_templates/form_component_textarea.html' %}
								</div>

							</div>
						</div>

						</div> <!-- /form-container-inner -->
						<div class="form-group form-footer padded">
							<div class="row">
								<div class="col-sm-12">
									<div class="form-footer-buttons">
										<input type="submit" class="btn btn-lg btn-primary" value="Start conversation">
										<input type="reset" class="btn btn-lg btn-default" value="Cancel">
									</div>
								</div>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>

{% endblock content %}
{% block sidebar %}

	{# if content.meta.permissions.create #}
		<div class="metabar-module">
			<h5>Got something to add?</h5>
			<div class="metabar-module-primary-buttons">
				<a href="{% url 'create-conversation' content.id %}" class="btn btn-large btn-block btn-primary">
					<span class="glyphicon glyphicon-comment"></span> Start a conversation
				</a>
				<a href="{% url 'create-event' content.id %}" class="btn btn-large btn-block btn-primary">
					<span class="glyphicon glyphicon-calendar"></span> Start an event
				</a>
			</div>
		</div> <!-- primary actions -->
	{# endif #}


	<div class="metabar-module">
		<h5>About</h5>
		<div class="metabar-module-title">
			<h3>
				{{ content.title }}
			</h3>

			{% include 'forms/subscribe.html' %}

			<p>
				{{ content.description }}
			</p>
			<p class="metabar-module-author">
				<a href="{% url 'single-profile' content.meta.created_by.id %}">
					<img src="{% if 'gravatar' in content.meta.created_by.avatar %}{{ content.meta.created_by.avatar }}{% elif 'files' in  content.meta.created_by.avatar  %}https://{{site.subdomain_key}}.microco.sm{{ content.meta.created_by.avatar }}{% else %}/static/img/avatar.gif{% endif %}" alt="Avatar for {{ content.meta.created_by.profile_name }}" />
					@{{ content.meta.created_by.profile_name|truncatechars:25 }}
				</a> started <time datetime="{{ content.meta.created|date:"c" }}"></time>
			</p>
		</div>
	</div> <!-- / about -->
{% endblock metabar %}


{% block js %}

<script type="text/javascript" src="{{STATIC_URL}}js/simpleEditor.js"></script>
<script type="text/javascript">
	(function(){

		var se = new simpleEditor({
			el : '.reply-box'
		});

	})();
</script>
{% endblock js %}